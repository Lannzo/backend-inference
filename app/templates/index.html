<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inference Results</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', path='css/dashboard.css') }}">
</head>

<body>
    <div class="page-shell">
        <header class="page-header">
            <span class="page-header__eyebrow">Inference Summary</span>
            <h1>Local Model Inference Report</h1>
            <div class="page-header__meta">
                <span><strong>Model</strong> {{ model_name }}</span>
                <span><strong>Modality</strong> {{ modality }}</span>
                {% if benchmarks %}
                <span><strong>Benchmark runs</strong> {{ benchmarks|length }}</span>
                {% endif %}
            </div>
        </header>

        {% if benchmarks %}
        <section class="summary">
            <div class="section-heading">
                <h2>Performance snapshots</h2>
                <p>Timing benchmarks captured during the session. Hover over a card to highlight how the
                    {{ model_name }} pipeline performed per batch size.</p>
            </div>
            <div class="summary__grid">
                {% for benchmark in benchmarks %}
                <article class="summary-card">
                    <div class="summary-card__title">{{ benchmark.num_files }} file{% if benchmark.num_files != 1 %}s{% endif %}
                        processed</div>
                    <div class="summary-card__value">{{ "%.2f"|format(benchmark.total_time) }}s</div>
                    <p class="summary-card__meta">Total elapsed time</p>
                    <p class="summary-card__meta">Average per tile <strong>{{ "%.3f"|format(benchmark.avg_time) }}s</strong></p>
                </article>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <section class="result-section">
            <div class="section-heading">
                <h2>Tile visualisations</h2>
                <p>Representative samples from the {% if benchmarks %}{{ benchmarks[0].num_files }}-file{% else %}latest{% endif %}
                    run. Compare inputs, labelled ground truth, and the model&apos;s predicted settlement mask.</p>
            </div>
            <div class="result-grid">
                {% for result in results %}
                <article class="result-card">
                    <div class="result-card__header">
                        <span class="result-card__id">Tile {{ result.id }}</span>
                        <span class="result-card__badge">Prediction vs truth</span>
                    </div>
                    <div class="result-card__body">
                        <div class="result-column">
                            <h3>Inputs</h3>
                            <div class="input-gallery">
                                {% set has_inputs = false %}
                                {% if result.inputs.satellite %}
                                {% set has_inputs = true %}
                                <figure class="input-preview">
                                    <img src="{{ url_for('static', path=result.inputs.satellite) }}"
                                        alt="Satellite imagery for tile {{ result.id }}">
                                    <figcaption>Satellite</figcaption>
                                </figure>
                                {% endif %}
                                {% if result.inputs.bc %}
                                {% set has_inputs = true %}
                                <figure class="input-preview">
                                    <img src="{{ url_for('static', path=result.inputs.bc) }}"
                                        alt="Building count raster for tile {{ result.id }}">
                                    <figcaption>Building count</figcaption>
                                </figure>
                                {% endif %}
                                {% if result.inputs.bh %}
                                {% set has_inputs = true %}
                                <figure class="input-preview">
                                    <img src="{{ url_for('static', path=result.inputs.bh) }}"
                                        alt="Built height raster for tile {{ result.id }}">
                                    <figcaption>Built height</figcaption>
                                </figure>
                                {% endif %}
                                {% if not has_inputs %}
                                <p class="result-note">No input imagery available for this tile.</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="result-column">
                            <h3>Ground truth</h3>
                            <img src="{{ url_for('static', path=result.ground_truth) }}"
                                alt="Ground truth mask for tile {{ result.id }}">
                        </div>
                        <div class="result-column">
                            <h3>Prediction</h3>
                            <img src="{{ url_for('static', path=result.prediction) }}"
                                alt="Model prediction mask for tile {{ result.id }}">
                        </div>
                    </div>
                    <p class="result-note">Generated with {{ model_name }} on the {{ modality }} modality stack.</p>
                </article>
                {% endfor %}
            </div>
        </section>
    </div>
</body>

</html>
